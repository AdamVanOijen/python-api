[tox]
envlist = py27, py35, py36, py37, pypy, pypy3, flake8, pep257, coverage, docs, mypy

[testenv]
passenv = CACOPHONY_PYTHON_CACOPHONYD_PATH CACOPHONY_VER
setenv = CACOPHONY_PYTHON_SKIP_SERVER_TESTS=False
deps = -r{toxinidir}/requirements.txt
       -r{toxinidir}/test-requirements.txt
#       py36: pandas==0.23.4
#       py36: numpy==1.15.4
#       py37: pandas==0.24.2
#       py37: numpy==1.16.2
commands = nose2 --verbose --with-doctest {posargs}

[testenv:flake8]
deps =
  flake8
  pep8-naming
commands = flake8 influxdb

[testenv:pep257]
deps = pydocstyle
commands = pydocstyle --count -ve examples cacophony

[testenv:coverage]
deps = -r{toxinidir}/requirements.txt
       -r{toxinidir}/test-requirements.txt
#       pandas
       coverage
#       numpy
commands = nose2 --verbose --with-coverage --coverage-report html --coverage cacophonyapi

[testenv:docs]
deps = -r{toxinidir}/requirements.txt
#       pandas==0.24.2
#       numpy==1.16.2
       Sphinx==1.8.5
       sphinx_rtd_theme
commands = sphinx-build -b html docs/source docs/build


[flake8]
ignore = W503,W504,W605,N802,F821,E402
# W503: Line break occurred before a binary operator
# W504: Line break occurred after a binary operator
# W605: invalid escape sequence
# N802: nosetests's setUp function
# F821: False positive in intluxdb/dataframe_client.py
# E402: module level import not at top of file
